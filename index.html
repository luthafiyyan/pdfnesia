<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    
    <!-- SECURITY HEADERS -->
    <meta http-equiv="Content-Security-Policy" content="
        default-src 'self'; 
        script-src 'self' 'unsafe-inline' 'unsafe-eval' https://cdn.tailwindcss.com https://unpkg.com https://cdnjs.cloudflare.com; 
        style-src 'self' 'unsafe-inline' https://cdnjs.cloudflare.com https://fonts.googleapis.com; 
        font-src 'self' https://cdnjs.cloudflare.com https://fonts.gstatic.com data:; 
        img-src 'self' data: blob: https://i.postimg.cc; 
        worker-src 'self' blob:; 
        connect-src 'self' https://unpkg.com https://cdnjs.cloudflare.com https://cdn.tailwindcss.com; 
        object-src 'none'; 
        base-uri 'self';
        form-action 'self';
        frame-ancestors 'none';
    ">
    <meta name="referrer" content="strict-origin-when-cross-origin">

    <!-- SEO & META TAGS -->
    <meta property="og:type" content="website">
    <meta property="og:url" content="https://pdfnesia.vercel.app/">
    <meta property="og:title" content="PDFnesia - Kelola PDF Mudah & Aman">
    <meta property="og:description" content="Gabung, Pisah, Kompres, dan Putar PDF langsung di browser. Tanpa upload server, 100% aman.">
    <meta property="og:image" content="https://i.postimg.cc/fW28BRxj/PDFnesia.png">

    <title>PDFnesia - Kelola PDF Anda</title>
    
    <link rel="icon" type="image/png" href="https://i.postimg.cc/fW28BRxj/PDFnesia.png">
    <link rel="apple-touch-icon" href="https://i.postimg.cc/fW28BRxj/PDFnesia.png">

    <!-- External CSS -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="style.css">
    
    <!-- Libraries -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/pdf-lib/dist/pdf-lib.min.js"></script>
    <script src="https://unpkg.com/downloadjs@1.4.7/download.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/mammoth/1.6.0/mammoth.browser.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.10.1/jszip.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/fabric.js/5.3.1/fabric.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
</head>
<body class="font-sans text-gray-700 bg-[#f8f9fc] dark:bg-slate-950 dark:text-gray-300 min-h-screen flex flex-col transition-colors duration-300">

    <!-- Navbar -->
    <nav class="bg-white/80 dark:bg-slate-900/80 backdrop-blur-md sticky top-0 z-50 border-b border-gray-100 dark:border-slate-800 transition-all">
        <div class="container mx-auto px-5 py-4 flex justify-between items-center">
            <a href="#" onclick="app.goHome()" class="flex items-center space-x-3 text-xl md:text-2xl font-bold text-gray-800 dark:text-white">
                <div class="w-9 h-9 md:w-10 md:h-10 bg-primary rounded-xl flex items-center justify-center text-white text-sm shadow-lg shadow-blue-500/30 overflow-hidden shrink-0">
                     <img src="https://i.postimg.cc/fW28BRxj/PDFnesia.png" alt="Logo" class="w-full h-full object-cover">
                </div>
                <span class="tracking-tight">PDFnesia</span>
            </a>
            
            <div class="hidden md:flex items-center space-x-8 text-sm font-medium text-gray-500 dark:text-gray-400">
                <a href="#" onclick="app.goHome()" class="hover:text-primary transition">Beranda</a>
                <a href="#" onclick="app.goPrivacy()" class="hover:text-primary transition">Privacy</a>
                <a href="#" onclick="app.goAbout()" class="hover:text-primary transition">Tentang</a>
                <button onclick="app.toggleTheme()" class="w-9 h-9 rounded-full bg-gray-100 dark:bg-slate-800 flex items-center justify-center text-gray-500 dark:text-yellow-400 hover:bg-gray-200 dark:hover:bg-slate-700 transition-all shadow-sm">
                    <i id="theme-icon" class="fa-solid fa-moon text-sm"></i>
                </button>
            </div>

            <div class="flex items-center md:hidden gap-3">
                <button onclick="app.toggleTheme()" class="w-10 h-10 rounded-full bg-gray-100 dark:bg-slate-800 flex items-center justify-center text-gray-500 dark:text-yellow-400 hover:bg-gray-200 dark:hover:bg-slate-700 transition-all shadow-sm active:scale-95">
                    <i id="theme-icon-mobile" class="fa-solid fa-moon text-sm"></i>
                </button>
                <button onclick="app.toggleMobileMenu()" class="w-10 h-10 flex items-center justify-center text-gray-600 dark:text-gray-300 focus:outline-none active:scale-95 bg-white dark:bg-slate-800 border border-gray-100 dark:border-slate-700 rounded-xl shadow-sm">
                    <i class="fa-solid fa-bars text-lg"></i>
                </button>
            </div>
        </div>
    </nav>

    <!-- Main Content Area -->
    <main id="main-container" class="flex-grow container mx-auto px-5 py-8 md:py-12">
        <!-- View: Landing Page -->
        <div id="view-home" class="animate-fade-in">
            <div class="text-center mb-10 md:mb-16 mt-4 md:mt-0">
                <span class="inline-block px-4 py-1.5 bg-primary/10 text-primary rounded-full text-xs font-bold tracking-wide uppercase mb-5">All-in-One PDF Tools</span>
                <h1 class="text-4xl md:text-6xl font-bold text-gray-900 dark:text-white mb-5 leading-tight">Solusi PDF <span class="text-primary">Mudah</span></h1>
                <p class="text-base md:text-lg text-gray-500 dark:text-gray-400 max-w-2xl mx-auto px-2 leading-relaxed">Kelola file PDF Anda dengan mudah, cepat, dan aman. Semua proses dilakukan di browser Anda tanpa upload ke server.</p>
            </div>
            <div id="features" class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-5 md:gap-8 max-w-6xl mx-auto"></div>
        </div>

        <!-- View: Privacy, About, Workspace (Standard) -->
        <div id="view-privacy" class="hidden animate-fade-in max-w-4xl mx-auto bg-white dark:bg-slate-900 p-6 md:p-10 rounded-2xl md:rounded-3xl shadow-soft border border-gray-100 dark:border-slate-800">
             <!-- Privacy Content (Same as before) -->
             <h1 class="text-2xl font-bold mb-4 dark:text-white">Kebijakan Privasi</h1>
             <p class="text-sm dark:text-gray-300">Aplikasi ini berjalan 100% di browser Anda. Tidak ada file yang diunggah ke server.</p>
             <button onclick="app.goHome()" class="mt-4 px-4 py-2 bg-primary text-white rounded-lg text-sm">Kembali</button>
        </div>

        <div id="view-about" class="hidden animate-fade-in max-w-5xl mx-auto">
             <!-- About Content (Same as before) -->
             <div class="bg-white dark:bg-slate-900 p-8 rounded-3xl border border-gray-100 dark:border-slate-800 text-center">
                 <h1 class="text-3xl font-bold mb-4 dark:text-white">Tentang PDFnesia</h1>
                 <p class="mb-4 dark:text-gray-300">Dibuat oleh Luthafiyyan. IT Support | Graphics Design Enthusiast | Vibe Coding</p>
                 <button onclick="app.goHome()" class="px-4 py-2 bg-primary text-white rounded-lg text-sm">Kembali</button>
             </div>
        </div>

        <div id="view-workspace" class="hidden max-w-5xl mx-auto bg-white dark:bg-slate-900 rounded-2xl md:rounded-3xl shadow-soft min-h-[600px] flex flex-col overflow-hidden border border-gray-50 dark:border-slate-800 transition-colors">
            <div class="px-5 py-4 md:px-8 md:py-6 border-b border-gray-100 dark:border-slate-800 flex justify-between items-center bg-white/90 dark:bg-slate-900/90 backdrop-blur z-10">
                <button onclick="app.goHome()" class="text-gray-400 hover:text-primary font-medium flex items-center transition text-sm">
                    <i class="fa-solid fa-arrow-left mr-2"></i> Kembali
                </button>
                <h2 id="tool-title" class="text-lg font-bold text-gray-800 dark:text-white">Nama Fitur</h2>
            </div>
            <div class="p-5 md:p-12 flex-grow flex flex-col items-center justify-center relative">
                <div id="step-upload" class="w-full max-w-2xl text-center mx-auto">
                    <div class="border-2 border-dashed border-gray-200 dark:border-slate-700 rounded-3xl p-8 md:p-16 hover:bg-surface dark:hover:bg-slate-800 hover:border-primary transition cursor-pointer group" onclick="app.triggerUpload()">
                        <i id="upload-icon" class="fa-solid fa-cloud-arrow-up text-4xl text-primary mb-4"></i>
                        <h3 id="upload-title" class="text-xl font-bold text-gray-800 dark:text-white mb-2">Pilih File</h3>
                        <p id="upload-desc" class="text-sm text-gray-500">Klik di sini untuk memilih file</p>
                        <input type="file" id="fileInput" class="hidden" accept=".pdf" multiple>
                        <input type="file" id="imgInput" class="hidden" accept="image/jpeg, image/png" multiple>
                    </div>
                </div>
                <div id="step-process" class="w-full hidden space-y-6 md:space-y-8 max-w-4xl mx-auto">
                    <div id="general-file-view" class="w-full bg-surface dark:bg-slate-950 p-4 rounded-2xl border border-gray-100 dark:border-slate-800">
                        <div id="file-list-container" class="grid grid-cols-2 md:grid-cols-4 gap-3"></div>
                        <div class="mt-4 text-center text-xs text-gray-400" id="drag-hint">Drag & Drop untuk mengatur urutan</div>
                    </div>
                    <div id="page-grid-view" class="hidden w-full">
                        <div id="page-grid-msg" class="bg-blue-50 dark:bg-blue-900/20 p-3 rounded-xl text-sm text-blue-800 dark:text-blue-300 mb-4">Info</div>
                        <div id="page-grid-container" class="grid grid-cols-3 gap-3 max-h-[400px] overflow-y-auto"></div>
                    </div>
                    <div id="controls-area" class="bg-white dark:bg-slate-900 p-5 rounded-2xl border border-gray-100 dark:border-slate-800"></div>
                    <div class="flex justify-center gap-4 mt-6">
                        <button id="btn-cancel" onclick="app.resetWorkspace()" class="px-6 py-3 border rounded-xl text-gray-500">Batal</button>
                        <button id="btn-process" class="px-6 py-3 bg-primary text-white rounded-xl font-bold shadow-lg">Proses</button>
                    </div>
                </div>
                <div id="step-loading" class="absolute inset-0 bg-white/90 dark:bg-slate-900/90 backdrop-blur-sm flex flex-col items-center justify-center hidden z-20">
                    <div class="loader mb-4"></div>
                    <p id="loading-text" class="text-gray-600 dark:text-gray-300">Sedang memproses...</p>
                </div>
            </div>
        </div>
        
        <!-- NEW Editor View (Full Screen) -->
        <div id="view-editor" class="hidden fixed inset-0 z-50 bg-gray-100 dark:bg-slate-950 flex flex-col">
            <!-- Header -->
            <header class="bg-white dark:bg-slate-900 border-b border-gray-200 dark:border-slate-800 px-4 py-2 flex justify-between items-center shadow-sm z-30 h-16">
                <div class="flex items-center gap-4">
                    <button onclick="app.goHome()" class="text-gray-500 hover:text-primary transition flex items-center gap-2">
                        <i class="fa-solid fa-arrow-left"></i> <span class="hidden sm:inline">Home</span>
                    </button>
                    <div class="h-6 w-px bg-gray-300 dark:bg-slate-700"></div>
                    <h2 class="text-base font-bold text-gray-800 dark:text-white">Editor PDF <span class="text-[10px] bg-blue-100 text-blue-600 px-2 py-0.5 rounded ml-2">BETA</span></h2>
                </div>
                
                <!-- Toolbar Area (Center) -->
                <div class="flex-1 flex justify-center px-4 overflow-x-auto no-scrollbar">
                     <div class="flex items-center gap-1 bg-gray-50 dark:bg-slate-800 p-1 rounded-lg border border-gray-200 dark:border-slate-700">
                        <button onclick="app.editor.undo()" class="p-2 rounded hover:bg-white dark:hover:bg-slate-700 text-gray-600 dark:text-gray-400" title="Undo"><i class="fa-solid fa-rotate-left"></i></button>
                        <button onclick="app.editor.redo()" class="p-2 rounded hover:bg-white dark:hover:bg-slate-700 text-gray-600 dark:text-gray-400" title="Redo"><i class="fa-solid fa-rotate-right"></i></button>
                        <div class="w-px h-5 bg-gray-300 dark:bg-slate-600 mx-1"></div>
                        
                        <button onclick="app.editor.addText()" class="p-2 rounded hover:bg-white dark:hover:bg-slate-700 text-gray-600 dark:text-gray-400 flex items-center gap-1" title="Teks">
                            <i class="fa-solid fa-font"></i>
                        </button>
                        <select id="editor-font-size" onchange="app.editor.setFontSize(this.value)" class="text-xs w-12 bg-transparent border-none text-gray-700 dark:text-gray-300 focus:ring-0">
                            <option value="12">12</option><option value="16">16</option><option value="20" selected>20</option><option value="24">24</option><option value="36">36</option>
                        </select>
                        <div class="w-px h-5 bg-gray-300 dark:bg-slate-600 mx-1"></div>

                        <button id="btn-draw" onclick="app.editor.toggleDraw()" class="p-2 rounded hover:bg-white dark:hover:bg-slate-700 text-gray-600 dark:text-gray-400" title="Gambar"><i class="fa-solid fa-pen"></i></button>
                        <button id="btn-highlight" onclick="app.editor.toggleHighlighter()" class="p-2 rounded hover:bg-white dark:hover:bg-slate-700 text-gray-600 dark:text-gray-400" title="Stabilo"><i class="fa-solid fa-highlighter"></i></button>
                        <input type="color" id="editor-color" value="#000000" onchange="app.editor.setColor(this.value)" class="w-6 h-6 rounded cursor-pointer border-none p-0 mx-1">
                        
                        <div class="w-px h-5 bg-gray-300 dark:bg-slate-600 mx-1"></div>
                        
                        <!-- Add File Dropdown -->
                        <div class="relative group">
                             <button class="p-2 rounded hover:bg-white dark:hover:bg-slate-700 text-gray-600 dark:text-gray-400 flex items-center gap-1">
                                <i class="fa-regular fa-image"></i> <i class="fa-solid fa-caret-down text-[10px]"></i>
                             </button>
                             <div class="absolute top-full left-0 mt-1 w-32 bg-white dark:bg-slate-800 border border-gray-200 dark:border-slate-700 rounded-lg shadow-lg hidden group-hover:block z-50">
                                <button onclick="document.getElementById('editor-insert-file').click()" class="block w-full text-left px-4 py-2 text-xs hover:bg-gray-50 dark:hover:bg-slate-700 dark:text-gray-300">Add Image</button>
                                <button onclick="app.editor.openSignatureModal()" class="block w-full text-left px-4 py-2 text-xs hover:bg-gray-50 dark:hover:bg-slate-700 dark:text-gray-300">Add Signature</button>
                             </div>
                             <input type="file" id="editor-insert-file" class="hidden" accept="image/jpeg,image/png" onchange="app.editor.addExternalFile(this.files[0])">
                        </div>

                        <button onclick="app.editor.deleteObject()" class="p-2 rounded hover:bg-red-50 text-red-500" title="Hapus Objek"><i class="fa-solid fa-trash"></i></button>
                     </div>
                </div>

                <div class="flex items-center gap-2">
                     <div class="hidden md:flex items-center bg-gray-100 dark:bg-slate-800 rounded-lg px-2 mr-2">
                        <button onclick="app.editor.changeZoom(-0.1)" class="p-1 text-gray-500 hover:text-primary"><i class="fa-solid fa-minus text-xs"></i></button>
                        <span id="zoom-level" class="text-xs font-mono w-10 text-center dark:text-gray-300">100%</span>
                        <button onclick="app.editor.changeZoom(0.1)" class="p-1 text-gray-500 hover:text-primary"><i class="fa-solid fa-plus text-xs"></i></button>
                     </div>
                    <button onclick="app.saveEditedPDF()" class="bg-primary hover:bg-primaryHover text-white px-4 py-2 rounded-lg text-sm font-bold shadow-lg shadow-blue-500/30 flex items-center gap-2">
                        <i class="fa-solid fa-download"></i> <span class="hidden sm:inline">Simpan</span>
                    </button>
                </div>
            </header>

            <!-- Main Workspace -->
            <div class="flex-grow flex overflow-hidden">
                <!-- Canvas Area -->
                <div id="editor-main-area" class="flex-grow bg-gray-200 dark:bg-slate-950 overflow-auto flex justify-center p-8 relative">
                    <div id="canvas-wrapper" class="relative shadow-2xl origin-top transition-transform duration-200">
                        <canvas id="fabric-canvas"></canvas>
                    </div>
                </div>

                <!-- Sidebar Pages -->
                <div id="editor-sidebar" class="w-64 bg-white dark:bg-slate-900 border-l border-gray-200 dark:border-slate-800 flex-shrink-0 hidden md:flex flex-col z-20">
                    <div class="p-3 border-b border-gray-100 dark:border-slate-800 font-bold text-xs text-gray-500 dark:text-gray-400 uppercase">Halaman</div>
                    <div id="editor-page-list" class="flex-grow overflow-y-auto p-4 space-y-4">
                        <!-- Thumbnails injected here -->
                    </div>
                </div>
            </div>
            
            <!-- Mobile Pagination -->
            <div class="md:hidden bg-white dark:bg-slate-900 border-t border-gray-200 dark:border-slate-800 p-3 flex justify-between items-center z-30">
                 <button onclick="app.editor.prevPage()" class="p-2 rounded-full bg-gray-100 dark:bg-slate-800"><i class="fa-solid fa-chevron-left"></i></button>
                 <span id="page-indicator" class="text-sm font-bold dark:text-white">Page 1</span>
                 <button onclick="app.editor.nextPage()" class="p-2 rounded-full bg-gray-100 dark:bg-slate-800"><i class="fa-solid fa-chevron-right"></i></button>
            </div>

            <!-- Signature Modal -->
            <div id="signature-modal" class="hidden fixed inset-0 z-[60] bg-black/50 flex items-center justify-center p-4 backdrop-blur-sm">
                <div class="bg-white dark:bg-slate-900 rounded-xl shadow-2xl w-full max-w-sm">
                    <div class="p-4 border-b border-gray-100 dark:border-slate-800 flex justify-between items-center">
                        <h3 class="font-bold dark:text-white">Tanda Tangan</h3>
                        <button onclick="app.editor.closeSignatureModal()"><i class="fa-solid fa-times text-gray-400"></i></button>
                    </div>
                    <div class="p-4">
                        <div class="flex gap-2 mb-3">
                            <button onclick="app.editor.switchSigTab('draw')" id="tab-draw" class="flex-1 py-1 text-xs font-bold rounded bg-primary text-white">Gambar</button>
                            <button onclick="app.editor.switchSigTab('upload')" id="tab-upload" class="flex-1 py-1 text-xs font-bold rounded bg-gray-100 dark:bg-slate-800 text-gray-500">Upload</button>
                        </div>
                        <div id="sig-pad-container" class="border-2 border-dashed border-gray-200 dark:border-slate-700 rounded-xl h-40 relative bg-white">
                            <canvas id="signature-pad" class="w-full h-full cursor-crosshair"></canvas>
                            <button onclick="app.editor.clearSignature()" class="absolute bottom-2 right-2 text-xs text-red-500 px-2 py-1 bg-white border rounded shadow-sm">Clear</button>
                        </div>
                        <div id="sig-upload-container" class="hidden h-40 border-2 border-dashed border-gray-200 dark:border-slate-700 rounded-xl flex flex-col items-center justify-center cursor-pointer" onclick="document.getElementById('sig-file-input').click()">
                            <i class="fa-solid fa-cloud-arrow-up text-2xl text-gray-400 mb-2"></i>
                            <span class="text-xs text-gray-500">Upload Gambar (PNG/JPG)</span>
                            <input type="file" id="sig-file-input" class="hidden" accept="image/*" onchange="app.editor.handleSigUpload(this.files[0])">
                        </div>
                        <button onclick="app.editor.addSignatureToPDF()" class="w-full mt-4 py-2 bg-primary text-white rounded-lg font-bold shadow-lg">Tambahkan</button>
                    </div>
                </div>
            </div>
            
            <!-- Editor Loader -->
            <div id="editor-loading" class="hidden absolute inset-0 bg-white/80 dark:bg-slate-900/80 backdrop-blur z-[70] flex flex-col items-center justify-center">
                <div class="loader mb-2"></div>
                <p class="text-sm font-medium dark:text-white">Memproses...</p>
            </div>
        </div>
    </main>

    <footer class="bg-white dark:bg-slate-900 border-t border-gray-100 dark:border-slate-800 py-6 mt-auto transition-colors">
        <div class="container mx-auto px-6 text-center">
            <p class="text-gray-400 dark:text-gray-500 text-xs md:text-sm">Made with ❤️ by <a href="https://www.instagram.com/luthafiyyan_/" target="_blank" rel="noopener noreferrer" class="text-primary hover:text-indigo-600 dark:hover:text-indigo-400 font-medium transition-colors">Luthafiyyan</a> Powered by caffeine & good vibes ☕✨</p>
        </div>
    </footer>

    <!-- Mobile Menu -->
    <div id="mobile-menu" class="hidden fixed inset-0 z-[100] bg-white dark:bg-slate-950 flex flex-col p-6 animate-fade-in transition-all overflow-y-auto">
        <div class="flex justify-between items-center mb-8">
            <div class="flex items-center space-x-3 text-2xl font-bold text-gray-800 dark:text-white">
                <div class="w-9 h-9 bg-primary rounded-xl flex items-center justify-center text-white text-sm overflow-hidden shadow-lg">
                    <img src="https://i.postimg.cc/fW28BRxj/PDFnesia.png" alt="Logo" class="w-full h-full object-cover">
                </div>
                <span>PDFnesia</span>
            </div>
            <button onclick="app.toggleMobileMenu()" class="w-10 h-10 flex items-center justify-center text-gray-500 dark:text-gray-400 bg-gray-100 dark:bg-slate-800 rounded-full hover:bg-gray-200 dark:hover:bg-slate-700 transition active:scale-95">
                <i class="fa-solid fa-times text-xl"></i>
            </button>
        </div>
        <div class="flex flex-col space-y-3">
            <a href="#" onclick="app.goHome(); app.toggleMobileMenu()" class="flex items-center justify-between p-4 rounded-2xl bg-gray-50 dark:bg-slate-900 text-gray-700 dark:text-gray-200 font-medium hover:bg-primary hover:text-white transition group">Beranda</a>
            <a href="#" onclick="app.goPrivacy(); app.toggleMobileMenu()" class="flex items-center justify-between p-4 rounded-2xl bg-gray-50 dark:bg-slate-900 text-gray-700 dark:text-gray-200 font-medium hover:bg-primary hover:text-white transition group">Privacy</a>
            <a href="#" onclick="app.goAbout(); app.toggleMobileMenu()" class="flex items-center justify-between p-4 rounded-2xl bg-gray-50 dark:bg-slate-900 text-gray-700 dark:text-gray-200 font-medium hover:bg-primary hover:text-white transition group">Tentang</a>
        </div>
    </div>

    <script src="script.js"></script>
</body>
</html>
